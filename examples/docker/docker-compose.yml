services:
  ocp:
    image: ${OCP_IMAGE:-openpolicyagent/opa-control-plane:edge}
    command:
      - run
      - --addr=0.0.0.0:8282
      - --apply-migrations
      - --config=/ocp.yml
      - --data-dir=/tmp
      - --log-level=debug
    volumes:
      - ./ocp.yml:/ocp.yml
    ports:
      - 8282:8282

  db:
    image: postgres:latest
    restart: always
    environment:
      POSTGRES_PASSWORD: sesame
    volumes:
      - pgdata:/var/lib/postgresql/data

  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - 9090:9090 # http://localhost:9090

volumes:
  pgdata:
